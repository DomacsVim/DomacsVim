name: Formatting

on: push

env:
  BRANCH_NAME: ${{ github.head_ref }}
  TOKEN: ${{ secrets.GH_TOKEN }}

jobs:
  stylua:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: JohnnyMorganz/stylua-action@v4.0.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          version: latest # NOTE: we recommend pinning to a specific version in case of formatting changes
          # CLI arguments
          args: -f .stylua -v .

      - name: Create Pull Request
        run: |
          PAYLOAD=$(cat <<EOF
            {
              "title": "Formatting with stylua",
              "body": "chore(*stylua*): Formatting with stylua.",
              "head": "${BRANCH_NAME}",
              "base": "main"
            }
          EOF
          )
          curl
            https://api.github.com/repos/my-user/my-repo/pulls \
            --header "Authorization: token ${TOKEN}" \
            -H "Content-Type:application/json" \
            -d "$PAYLOAD"
